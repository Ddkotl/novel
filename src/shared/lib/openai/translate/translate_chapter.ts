import { client, TEXT_AI_MODEL } from "../ai_client";

export const translateChapter = async (
  text: string,
  context?: string,
  temperature?: number,
): Promise<string> => {
  try {
    const chatCompletion =
      await client.chat.completions.create({
        messages: [
          {
            role: "system",
            content:
              "Отвечай на русском языке строго в  формате строки,  без добавления комментариев.",
          },
          {
            role: "user",
            content: `
            Проанализируй следующий текст и переведи с китайского на русский язык.
            Это глава художественной новеллы. Перевод должен быть литературным: красивым, плавным, живым.
            Стиль перевода — естественный для русскоязычного читателя, как качественный художественный роман.
            Требования:
            Сохраняй общий тон и атмосферу оригинала.
            Имена персонажей, кланов, городов и организаций транслитерируй (передавай звучание русскими буквами, без перевода).
            Титулы вроде "Мастер", "Старший Брат", "Старейшина" переводи на русский.
            Идиомы (成语) перефразируй красиво и естественно на русском, стараясь передать их смысл.
            Поэтические описания передавай художественно, без дословного копирования.
            Диалоги оформляй как живую речь, естественно для русского языка.
            Следи за логикой сюжета — не упускай детали и не меняй событий.
            Не добавляй ничего от себя и не изменяй имена или отношения персонажей.
            Если текст длинный, разделяй его логически на абзацы, но не укорачивай текст.
            Вот текст главы: ${text}
            `,
          },
        ],
        temperature: temperature ? temperature : 0,
        model: TEXT_AI_MODEL,
      });
    return chatCompletion.choices[0].message
      .content as string;
  } catch (e) {
    console.error("ai translate text error", e);
    return "";
  }
};
